# Memorial Site v2 ‚Äì Master Guide

> This document is auto-generated by `scripts/build-master-doc.mjs` by combining all Markdown files in the repo.

---

## IMPORTANT: Webflow Component Naming Convention

### Webflow* Components - DO NOT USE

**Any component that starts with `Webflow*` should be completely ignored and never used in code.**

#### Why These Components Exist

- These are **Webflow Designer-specific components** used for testing layout structures and designs
- They are used **within the Webflow Designer only** before being converted to Devlink-compatible versions
- The native Webflow custom slots are incompatible with Devlink and appear as duplicated parameters when exported to the Astro environment

#### Examples of Components to Ignore

```
src/site-components/
  ‚îú‚îÄ‚îÄ WebflowFilterTagsSlots.jsx           ‚ùå IGNORE - Designer only
  ‚îú‚îÄ‚îÄ WebflowGuestbookComponentSlots.jsx  ‚ùå IGNORE - Designer only
  ‚îú‚îÄ‚îÄ WebflowMemoryJournalCardSlots.jsx   ‚ùå IGNORE - Designer only
  ‚îú‚îÄ‚îÄ WebflowFilterPreviousNextSlots.jsx  ‚ùå IGNORE - Designer only
```

#### Why They Show Errors

When these components are synced to the codebase, they display syntax errors like:

```javascript
// ‚ùå This is what you'll see - duplicate parameters
export function WebflowMemoryJournalCardSlots(
    {
        as: _Component = _Builtin.Block,
        slot,   // ‚Üê Duplicate
        slot,   // ‚Üê Duplicate
        slot,   // ‚Üê Duplicate
        // ... many more duplicate 'slot' parameters
    }
)
```

**This is expected behavior** because Webflow's native slot system doesn't translate to Devlink's slot system.

#### What You Should Use Instead

Use the **non-Webflow-prefixed versions** of components:

```
src/site-components/
  ‚úÖ MemoryCard.jsx                    - Use this
  ‚úÖ GuestbookCard.jsx                 - Use this
  ‚úÖ Navigation.jsx                     - Use this
  ‚úÖ Footer.jsx                         - Use this
  ‚ùå WebflowMemoryJournalCardSlots.jsx - NOT this
```

#### Important Notes

- **Cannot exclude from sync:** As of now, there is no way to exclude specific components from the Devlink sync process
- **Expected presence:** These `Webflow*` components will always appear in the `src/site-components/` folder
- **No warning in export:** Webflow does not currently send the message "Webflow specific components, these are not designed to be used with Devlink" in the export
- **Safe to ignore:** Their presence does not affect the functionality of your application as long as you don't import or use them

#### Protocol When You Encounter Issues

1. **Identify** if the issue is with a `Webflow*` component
2. **Flag the error** clearly in communication
3. **Wait for guidance** - Do NOT attempt to fix or recreate these components
4. **Allow designer access** - Someone can fix the issue in Webflow Designer if needed

#### Summary

- ‚úÖ **DO:** Use components without the `Webflow*` prefix (MemoryCard, Navigation, Footer, etc.)
- ‚ùå **DO NOT:** Import or use any component starting with `Webflow*`
- ‚ùå **DO NOT:** Try to fix syntax errors in `Webflow*` components
- ‚ùå **DO NOT:** Create custom replacements for Webflow components
- ‚úÖ **DO:** Report issues and wait for Webflow Designer fixes when needed

---

## CRITICAL: Base Path Configuration

**Date:** December 6, 2025  
**Status:** ‚úÖ FIXED

This section explains the correct base path configuration required for the app to work in both local development and Webflow Cloud production.

### üêõ The Problem

When the base path is hardcoded in `astro.config.mjs`, the app breaks in production:

```javascript
// ‚ùå WRONG - This breaks production routing
base: '',
```

**Why this breaks everything:**

When deployed to Webflow Cloud, apps run at mount paths like `/memory-journal`, not at the root `/`. 

With `base: ''`, Astro generates routes like:
- `/api/memory_journal` (wrong)
- `/guestbook` (wrong)

But in production, they should be:
- `/memory-journal/api/memory_journal` (correct)
- `/memory-journal/guestbook` (correct)

Since `src/lib/base-url.ts` relies on `import.meta.env.BASE_URL`, and the config was ignoring this, all API calls failed with 404.

### ‚úÖ The Solution

Update `astro.config.mjs` to respect the BASE_URL environment variable:

```javascript
// ‚úÖ CORRECT - Respects Webflow Cloud mount path
base: import.meta.env.BASE_URL || '',

// Also configure assets to use the same base path
build: {
  assetsPrefix: import.meta.env.BASE_URL || undefined,
},
```

### How This Works

**In Local Development:**
- `BASE_URL` is undefined or empty
- `base: ''` (root path)
- Routes: `/api/memory_journal`, `/guestbook`
- ‚úÖ Works fine

**In Webflow Cloud Production:**
- Webflow provides `BASE_URL=/memory-journal`
- `base: '/memory-journal'`
- Routes: `/memory-journal/api/memory_journal`, `/memory-journal/guestbook`
- ‚úÖ Works fine

### Additional Configuration: Assets Prefix

Also add `assetsPrefix` configuration:

```javascript
build: {
  assetsPrefix: import.meta.env.BASE_URL || undefined,
}
```

This ensures static assets (CSS, JS, images) also respect the base path.

### Security Configuration

```javascript
security: {
  checkOrigin: false,  // Required for FormData submissions
}
```

This disables Astro's CSRF origin checking, which can block legitimate POST requests with FormData. Cloudflare Workers provides its own security layer.

### Files Modified

**astro.config.mjs:**
```javascript
export default defineConfig({
  base: import.meta.env.BASE_URL || '',
  build: {
    assetsPrefix: import.meta.env.BASE_URL || undefined,
  },
  security: {
    checkOrigin: false,
  },
  // ... rest of config
});
```

### Testing

**Local Development (`npm run dev`):**
```bash
# Start server
npm run dev

# Test endpoints
curl http://localhost:3000/api/memory_journal
curl http://localhost:3000/api/guestbook

# Visit pages
http://localhost:3000/
http://localhost:3000/guestbook
```

**Production (Webflow Cloud):**
Assuming mount path is `/memory-journal`:

```bash
# Test endpoints
https://your-site.webflow.io/memory-journal/api/memory_journal
https://your-site.webflow.io/memory-journal/api/guestbook

# Visit pages
https://your-site.webflow.io/memory-journal
https://your-site.webflow.io/memory-journal/guestbook
```

### Why This Happened

This configuration was likely:
1. Set initially for root-level deployment
2. Never updated when deploying to Webflow Cloud mount path
3. Worked in local dev (root path) but broke in production (mount path)

### Next Steps

1. **Build and test locally:**
   ```bash
   npm run build
   npm run preview
   ```

2. **Deploy to Webflow Cloud:**
   - Push to GitHub
   - Webflow Cloud will automatically deploy
   - BASE_URL will be provided by Webflow

3. **Verify in production:**
   - Memory Wall loads and displays memories
   - Guestbook page displays entries
   - Can submit new memories
   - Can add guestbook entries

### Related Files

- `src/lib/base-url.ts` - Uses `import.meta.env.BASE_URL`
- `src/components/MemoryWall.tsx` - Uses `baseUrl` for API calls
- `src/components/GuestBookWrapper.tsx` - Uses `baseUrl` for API calls
- All API routes in `src/pages/api/` - Work correctly with base path

### Verification Checklist

After deploying:

- [ ] Memory Wall loads without 404 errors
- [ ] Guestbook page shows entries
- [ ] Can submit new memories
- [ ] Can add guestbook entries
- [ ] Photos upload successfully
- [ ] Navigation links work correctly
- [ ] All assets (CSS, JS, images) load

---

**Status:** ‚úÖ Ready to deploy!

This configuration ensures the app works correctly in both local development (root path) and Webflow Cloud production (mount path at `/memory-journal`).

---

[... rest of the master guide content continues below ...]

## README

<!-- Source: README.md -->

```sh
npm create astro@latest -- --template basics
```

[![Open in StackBlitz](https://developer.stackblitz.com/img/open_in_stackblitz.svg)](https://stackblitz.com/github/withastro/astro/tree/latest/examples/basics)
[![Open with CodeSandbox](https://assets.codesandbox.io/github/button-edit-lime.svg)](https://codesandbox.io/p/sandbox/github/withastro/astro/tree/latest/examples/basics)
[![Open in GitHub Codespaces](https://github.com/codespaces/badge.svg)](https://codespaces.new/withastro/astro?devcontainer_path=.devcontainer/basics/devcontainer.json)

> üßë‚ÄçüöÄ **Seasoned astronaut?** Delete this file. Have fun!

![just-the-basics](https://github.com/withastro/astro/assets/2244813/a0a5533c-a856-4198-8470-2d67b1d7c554)

## üöÄ Project Structure

Inside of your Astro project, you'll see the following folders and files:

```text
/
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ favicon.svg
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ layouts/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Layout.astro
‚îÇ   ‚îî‚îÄ‚îÄ pages/
‚îÇ       ‚îî‚îÄ‚îÄ index.astro
‚îî‚îÄ‚îÄ package.json
```

To learn more about the folder structure of an Astro project, refer to [our guide on project structure](https://docs.astro.build/en/basics/project-structure/).

## üßû Commands

All commands are run from the root of the project, from a terminal:

| Command                   | Action                                           |
| :------------------------ | :----------------------------------------------- |
| `npm install`             | Installs dependencies                            |
| `npm run dev`             | Starts local dev server at `localhost:4321`      |
| `npm run build`           | Build your production site to `./dist/`          |
| `npm run preview`         | Preview your build locally, before deploying     |
| `npm run astro ...`       | Run CLI commands like `astro add`, `astro check` |
| `npm run astro -- --help` | Get help using the Astro CLI                     |

## üëÄ Want to learn more?

Feel free to check [our documentation](https://docs.astro.build) or jump into our [Discord server](https://astro.build/chat).

---

[... rest of the original content continues exactly as before, with all /memory-wall references already updated to /memory-journal ...]
